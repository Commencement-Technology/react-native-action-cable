var AppState,ConnectionMonitor,bind=function(t,n){return function(){return t.apply(n,arguments)}};AppState=require("react-native").AppState,ConnectionMonitor=function(){function t(t,n){this.connection=t,this.log=n,this.visibilityDidChange=bind(this.visibilityDidChange,this),this.reconnectAttempts=0}var n,e,o;return t.pollInterval={min:3,max:30},t.staleThreshold=6,t.prototype.start=function(){if(!this.isRunning())return this.startedAt=e(),delete this.stoppedAt,this.startPolling(),AppState.addEventListener("change",this.visibilityDidChange),this.log("ConnectionMonitor started. pollInterval = "+this.getPollInterval()+" ms")},t.prototype.stop=function(){if(this.isRunning())return this.stoppedAt=e(),this.stopPolling(),AppState.removeEventListener("change",this.visibilityDidChange),this.log("ConnectionMonitor stopped")},t.prototype.isRunning=function(){return null!=this.startedAt&&null==this.stoppedAt},t.prototype.recordPing=function(){return this.pingedAt=e()},t.prototype.recordConnect=function(){return this.reconnectAttempts=0,this.recordPing(),delete this.disconnectedAt,this.log("ConnectionMonitor recorded connect")},t.prototype.recordDisconnect=function(){return this.disconnectedAt=e(),this.log("ConnectionMonitor recorded disconnect")},t.prototype.startPolling=function(){return this.stopPolling(),this.poll()},t.prototype.stopPolling=function(){return clearTimeout(this.pollTimeout)},t.prototype.poll=function(){return this.pollTimeout=setTimeout(function(t){return function(){return t.reconnectIfStale(),t.poll()}}(this),this.getPollInterval())},t.prototype.getPollInterval=function(){var t,e,o,i;return i=this.constructor.pollInterval,o=i.min,e=i.max,t=5*Math.log(this.reconnectAttempts+1),Math.round(1e3*n(t,o,e))},t.prototype.reconnectIfStale=function(){if(this.connectionIsStale())return this.log("ConnectionMonitor detected stale connection. reconnectAttempts = "+this.reconnectAttempts+", pollInterval = "+this.getPollInterval()+" ms, time disconnected = "+o(this.disconnectedAt)+" s, stale threshold = "+this.constructor.staleThreshold+" s"),this.reconnectAttempts++,this.disconnectedRecently()?this.log("ConnectionMonitor skipping reopening recent disconnect"):(this.log("ConnectionMonitor reopening"),this.connection.reopen())},t.prototype.connectionIsStale=function(){var t;return o(null!=(t=this.pingedAt)?t:this.startedAt)>this.constructor.staleThreshold},t.prototype.disconnectedRecently=function(){return this.disconnectedAt&&o(this.disconnectedAt)<this.constructor.staleThreshold},t.prototype.visibilityDidChange=function(){if("active"===AppState.currentState)return setTimeout(function(t){return function(){if(t.connectionIsStale()||!t.connection.isOpen())return t.log("ConnectionMonitor reopening stale connection on change. visbilityState = "+AppState.currentState),t.connection.reopen()}}(this),200)},e=function(){return(new Date).getTime()},o=function(t){return(e()-t)/1e3},n=function(t,n,e){return Math.max(n,Math.min(e,t))},t}(),module.exports=ConnectionMonitor;