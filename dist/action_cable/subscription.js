var EventEmitter,Subscription,extend1=function(t,i){function n(){this.constructor=t}for(var r in i)hasProp.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},hasProp={}.hasOwnProperty;EventEmitter=require("eventemitter3"),Subscription=function(t){function i(t,i,r){var e,s,o,u,c;for(this.subscriptions=t,null==i&&(i={}),this.actions=r,this.identifier=JSON.stringify(i),u={},c=this.actions,s=0,o=c.length;o>s;s++)e=c[s],u[e]=function(){return this.emit(e)};n(this,u),this.subscriptions.add(this),this.consumer=this.subscriptions.consumer}var n;return extend1(i,t),i.prototype.perform=function(t,i){return null==i&&(i={}),i.action=t,this.send(i)},i.prototype.send=function(t){return this.consumer.send({command:"message",identifier:this.identifier,data:JSON.stringify(t)})},i.prototype.unsubscribe=function(){return this.subscriptions.remove(this)},n=function(t,i){var n,r;if(null!=i)for(n in i)r=i[n],t[n]=r;return t},i}(EventEmitter),module.exports=Subscription;