var INTERNAL,Subscription,Subscriptions;INTERNAL=require("./internal"),Subscription=require("./subscription"),Subscriptions=class{constructor(i){this.consumer=i,this.subscriptions=[]}create(i){var t,s,r;return s="object"==typeof(t=i)?t:{channel:t},r=new Subscription(this.consumer,s),this.add(r)}add(i){return this.subscriptions.push(i),this.consumer.ensureActiveConnection(),this.notify(i,"initialized"),this.sendCommand(i,"subscribe"),i}remove(i){return this.forget(i),this.findAll(i.identifier).length||this.sendCommand(i,"unsubscribe"),i}reject(i){var t,s,r,n,e;for(n=[],t=0,s=(r=this.findAll(i)).length;t<s;t++)e=r[t],this.forget(e),this.notify(e,"rejected"),n.push(e);return n}forget(i){var t;return this.subscriptions=function(){var s,r,n,e;for(e=[],s=0,r=(n=this.subscriptions).length;s<r;s++)(t=n[s])!==i&&e.push(t);return e}.call(this),i}findAll(i){var t,s,r,n,e;for(n=[],t=0,s=(r=this.subscriptions).length;t<s;t++)(e=r[t]).identifier===i&&n.push(e);return n}reload(){var i,t,s,r,n;for(r=[],i=0,t=(s=this.subscriptions).length;i<t;i++)n=s[i],r.push(this.sendCommand(n,"subscribe"));return r}notifyAll(i,...t){var s,r,n,e,o;for(e=[],s=0,r=(n=this.subscriptions).length;s<r;s++)o=n[s],e.push(this.notify(o,i,...t));return e}notify(i,t,...s){var r,n,e,o;for(e=[],r=0,n=(o="string"==typeof i?this.findAll(i):[i]).length;r<n;r++)i=o[r],e.push("function"==typeof i[t]?i[t](...s):void 0);return e}sendCommand(i,t){var s;return({identifier:s}=i),this.consumer.send({command:t,identifier:s})}},module.exports=Subscriptions;